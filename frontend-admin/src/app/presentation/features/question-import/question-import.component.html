<div class="modal-overlay" (click)="cancel()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Importer des questions depuis Excel</h2>
      <button class="btn-close" (click)="cancel()">√ó</button>
    </div>

    <div class="modal-body">
      @if (errorMessage()) {
        <div class="alert alert-error">{{ errorMessage() }}</div>
      }

      @if (!showPreview()) {
        <!-- Step 1: File Selection -->
        <div class="import-section">
          <div class="section-header">
            <div class="step-number">1</div>
            <div>
              <h3>T√©l√©chargez le mod√®le Excel</h3>
              <p>Utilisez notre mod√®le pour formater correctement vos questions</p>
            </div>
          </div>
          <button class="btn-download" (click)="downloadTemplate()">
            <span class="material-icons">download</span> T√©l√©charger le mod√®le Excel
          </button>
          <p class="download-hint">üìä Fichier .xlsx avec exemples et instructions</p>
        </div>

        <div class="divider"></div>

        <div class="import-section">
          <div class="section-header">
            <div class="step-number">2</div>
            <div>
              <h3>T√©l√©versez votre fichier</h3>
              <p>S√©lectionnez le fichier Excel contenant vos questions</p>
            </div>
          </div>

          <div class="upload-area">
            <input 
              type="file" 
              id="file-input" 
              accept=".xlsx,.xls"
              (change)="onFileSelected($event)"
              hidden
            />
            <label for="file-input" class="upload-label">
              <span class="material-icons">upload_file</span>
              <span class="upload-text">
                @if (selectedFile()) {
                  <strong>{{ selectedFile()!.name }}</strong>
                } @else {
                  <strong>Cliquez pour s√©lectionner</strong> ou glissez-d√©posez
                }
              </span>
              <span class="upload-hint">Formats accept√©s: .xlsx, .xls (max 5MB)</span>
            </label>
          </div>

          @if (selectedFile()) {
            <div class="file-info">
              <span class="material-icons">description</span>
              <div class="file-details">
                <div class="file-name">{{ selectedFile()!.name }}</div>
                <div class="file-size">{{ (selectedFile()!.size / 1024).toFixed(2) }} KB</div>
              </div>
              <button class="btn-remove-file" (click)="resetImport()">
                <span class="material-icons">delete</span>
              </button>
            </div>
          }
        </div>

        <div class="info-box">
          <span class="material-icons">info</span>
          <div>
            <strong>Format du fichier :</strong>
            <ul>
              <li>Colonne 1 (Enonce) : Texte de la question</li>
              <li>Colonne 2 (Type) : CHOIX_MULTIPLE ou REPONSE_OUVERTE</li>
              <li>Colonne 3 (Options) : Options s√©par√©es par ; pour les QCM</li>
            </ul>
          </div>
        </div>
      }

      @if (showPreview()) {
        <!-- Step 3: Preview -->
        <div class="preview-section">
          <div class="preview-header">
            <h3>Pr√©visualisation</h3>
            <p>{{ previewQuestions().length }} questions d√©tect√©es</p>
          </div>

          <div class="preview-list">
            @for (question of previewQuestions(); track 'question_' + $index) {
              <div class="preview-item">
                <div class="preview-number">{{ $index + 1 }}</div>
                <div class="preview-content">
                  <div class="preview-type">{{ question.type }}</div>
                  <div class="preview-text">{{ question.enonce }}</div>
                  @if (question.options && question.options.length > 0) {
                    <div class="preview-options">
                      @for (option of question.options; track option + '_' + $index) {
                        <span class="preview-option">{{ option }}</span>
                      }
                    </div>
                  }
                </div>
              </div>
            }
          </div>

          <button class="btn-back" (click)="resetImport()">
            <span class="material-icons">arrow_back</span> Modifier le fichier
          </button>
        </div>
      }
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="cancel()" [disabled]="isLoading()">
        Annuler
      </button>
      @if (!showPreview()) {
        <button 
          class="btn-primary" 
          (click)="validateAndPreview()" 
          [disabled]="!selectedFile() || isLoading()"
        >
          @if (isLoading()) {
            <span>Validation...</span>
          } @else {
            <span>Valider et pr√©visualiser</span>
          }
        </button>
      }
      @if (showPreview()) {
        <button class="btn-primary" (click)="confirmImport()" [disabled]="isLoading()">
          @if (isLoading()) {
            <span>Import en cours...</span>
          } @else {
            <span>Confirmer l'import</span>
          }
        </button>
      }
    </div>
  </div>
</div>

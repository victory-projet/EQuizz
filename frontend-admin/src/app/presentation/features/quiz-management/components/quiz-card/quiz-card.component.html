<div class="quiz-card">
  <div class="card-header">
    <div class="status-badge" [class]="getStatusClass()">
      {{ getStatusLabel() }}
    </div>
    <div class="card-menu">
      <button class="menu-btn" (click)="toggleMenu()">
        <app-svg-icon name="MoreVertical" size="sm" />
      </button>
      @if (showMenuDropdown()) {
        <div class="menu-dropdown" (click)="$event.stopPropagation()">
          <button (click)="onPreview()">
            <app-svg-icon name="Eye" />
            Aperçu
          </button>
          <button (click)="onDuplicate()">
            <app-svg-icon name="Copy" />
            Dupliquer
          </button>
          <button (click)="onDelete()" class="danger">
            <app-svg-icon name="Trash2" />
            Supprimer
          </button>
        </div>
      }
    </div>
  </div>

  <div class="card-content">
    <h3>{{ quiz().title }}</h3>
    <p class="description">{{ quiz().subject }}</p>
    
    <div class="card-stats">
      <div class="stat">
        <app-svg-icon name="HelpCircle" size="sm" />
        <span>{{ quiz().questions.length || 0 }} questions</span>
      </div>
      <div class="stat">
        <app-svg-icon name="Users" size="sm" />
        <span>{{ getClassInfo() }}</span>
      </div>
      <div class="stat">
        <app-svg-icon name="Calendar" size="sm" />
        <span>{{ getSemesterInfo() }}</span>
      </div>
      @if (quiz().endDate !== undefined) {
        <div class="stat">
          <app-svg-icon name="Clock" size="sm" />
          <span>Fin: {{ formatDate(quiz().endDate!) }}</span>
        </div>
      }
    </div>
  </div>

  <div class="card-footer">
    @if (quiz().isDraft()) {
      <!-- Brouillon: Bouton Continuer + Publier -->
      <button class="btn-secondary" (click)="onContinue()">
        <app-svg-icon name="Play" size="sm" />
        Continuer
      </button>
      <button class="btn-accent" (click)="onPublish()">
        <app-svg-icon name="Send" size="sm" />
        Publier
      </button>
    } @else if (quiz().isActive()) {
      <!-- Actif: Bouton Aperçu uniquement (pas de modification ni fermeture manuelle) -->
      <button class="btn-outline" (click)="onPreview()">
        <app-svg-icon name="Eye" size="sm" />
        Aperçu
      </button>
      <button class="btn-secondary" (click)="onViewResults()">
        <app-svg-icon name="BarChart" size="sm" />
        Résultats
      </button>
    } @else {
      <!-- Fermé: Bouton Voir résultats uniquement (pas de modification) -->
      <button class="btn-outline" (click)="onViewResults()">
        <app-svg-icon name="BarChart" size="sm" />
        Résultats
      </button>
      <button class="btn-secondary" (click)="onPreview()">
        <app-svg-icon name="Eye" size="sm" />
        Aperçu
      </button>
    }
  </div>
</div>

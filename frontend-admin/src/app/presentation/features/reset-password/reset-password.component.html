<div class="reset-password-container">
  <!-- Background Image -->
  <div class="background-image"></div>
  
  <!-- Overlay -->
  <div class="overlay"></div>

  <!-- Reset Password Card -->
  <div class="reset-password-card">
    <!-- Logo -->
    <div class="logo-container">
      <div class="logo">
        <span class="material-icons">school</span>
      </div>
      <h1 class="app-name">EQuizz</h1>
      <p class="app-tagline">Réinitialisation du mot de passe</p>
    </div>

    <!-- Loading Token Validation -->
    @if (isValidatingToken()) {
      <div class="loading-container">
        <div class="spinner-large"></div>
        <h2>Validation du lien...</h2>
        <p>Veuillez patienter pendant que nous validons votre lien de réinitialisation.</p>
      </div>
    }

    <!-- Invalid Token -->
    @if (!isValidatingToken() && !tokenValid()) {
      <div class="error-container">
        <div class="error-icon">
          <span class="material-icons">error</span>
        </div>
        <h2>Lien invalide</h2>
        <p>{{ errorMessage() }}</p>
        <button class="submit-button" (click)="goToLogin()">
          <span>Retour à la connexion</span>
          <span class="material-icons">arrow_forward</span>
        </button>
      </div>
    }

    <!-- Reset Password Form -->
    @if (!isValidatingToken() && tokenValid()) {
      <form class="reset-form" (ngSubmit)="onSubmit()">
        <h2 class="form-title">Nouveau mot de passe</h2>
        <p class="form-subtitle">
          @if (email()) {
            Créez un nouveau mot de passe pour <strong>{{ email() }}</strong>
          } @else {
            Créez votre nouveau mot de passe
          }
        </p>

        <!-- Success Message -->
        @if (successMessage()) {
          <div class="alert alert-success">
            <span class="material-icons">check_circle</span>
            <div>
              <span>{{ successMessage() }}</span>
              <br>
              <small>Redirection vers la page de connexion...</small>
            </div>
          </div>
        }

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="alert alert-error">
            <span class="material-icons">error</span>
            <span>{{ errorMessage() }}</span>
          </div>
        }

        @if (!successMessage()) {
          <!-- New Password Field -->
          <div class="form-group">
            <label for="new-password">Nouveau mot de passe</label>
            <div class="input-wrapper">
              <span class="material-icons input-icon">lock</span>
              <input
                [type]="showNewPassword() ? 'text' : 'password'"
                id="new-password"
                name="new-password"
                [(ngModel)]="newPassword"
                placeholder="••••••••"
                required
                minlength="8"
                autocomplete="new-password"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="toggleNewPassword()"
                tabindex="-1"
              >
                <span class="material-icons">
                  {{ showNewPassword() ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
            <small class="field-hint">
              Au moins 8 caractères avec majuscules, minuscules, chiffres et caractères spéciaux
            </small>
          </div>

          <!-- Confirm Password Field -->
          <div class="form-group">
            <label for="confirm-password">Confirmer le mot de passe</label>
            <div class="input-wrapper">
              <span class="material-icons input-icon">lock</span>
              <input
                [type]="showConfirmPassword() ? 'text' : 'password'"
                id="confirm-password"
                name="confirm-password"
                [(ngModel)]="confirmPassword"
                placeholder="••••••••"
                required
                autocomplete="new-password"
              />
              <button
                type="button"
                class="toggle-password"
                (click)="toggleConfirmPassword()"
                tabindex="-1"
              >
                <span class="material-icons">
                  {{ showConfirmPassword() ? 'visibility_off' : 'visibility' }}
                </span>
              </button>
            </div>
          </div>

          <!-- Submit Button -->
          <button
            type="submit"
            class="submit-button"
            [disabled]="isLoading() || !newPassword || !confirmPassword"
          >
            @if (isLoading()) {
              <span class="spinner"></span>
              <span>Réinitialisation...</span>
            } @else {
              <span>Réinitialiser le mot de passe</span>
              <span class="material-icons">check</span>
            }
          </button>
        }

        <!-- Back to Login -->
        <div class="form-footer">
          <button type="button" class="link-button" (click)="goToLogin()">
            <span class="material-icons">arrow_back</span>
            <span>Retour à la connexion</span>
          </button>
        </div>
      </form>
    }
  </div>
</div>

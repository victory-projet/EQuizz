<div class="courses-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>
        <app-svg-icon name="BookOpen" class="title-icon"></app-svg-icon>
        Gestion des Cours
      </h1>
      <p class="subtitle">Gérez vos unités d'enseignement et cours</p>
    </div>
    <button class="btn-primary" (click)="addCourse()">
      <app-svg-icon name="Plus"></app-svg-icon>
      Ajouter un Cours
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue">
        <app-svg-icon name="BookOpen"></app-svg-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total Cours</div>
        <div class="stat-value">{{ totalCourses() }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon green">
        <app-svg-icon name="CheckCircle2"></app-svg-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Cours Actifs</div>
        <div class="stat-value">{{ activeCourses() }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon purple">
        <app-svg-icon name="Users"></app-svg-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total Étudiants</div>
        <div class="stat-value">{{ totalStudents() }}</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon orange">
        <app-svg-icon name="Calendar"></app-svg-icon>
      </div>
      <div class="stat-content">
        <div class="stat-label">Semestres</div>
        <div class="stat-value">2</div>
      </div>
    </div>
  </div>

  <!-- Search Bar -->
  <div class="search-section">
    <app-search-bar 
      placeholder="Rechercher un cours par nom ou code..."
      (search)="onSearchChange($event)">
    </app-search-bar>
  </div>

  <!-- Filter Tabs -->
  <div class="filter-tabs">
    <button 
      class="tab" 
      [class.active]="activeFilter() === 'all'"
      (click)="setFilter('all')">
      <app-svg-icon name="List"></app-svg-icon>
      Tous ({{ totalCourses() }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeFilter() === 'active'"
      (click)="setFilter('active')">
      <app-svg-icon name="CheckCircle2"></app-svg-icon>
      Actifs ({{ activeCourses() }})
    </button>
    <button 
      class="tab" 
      [class.active]="activeFilter() === 'semester1'"
      (click)="setFilter('semester1')">
      <app-svg-icon name="Calendar"></app-svg-icon>
      Semestre 1
    </button>
    <button 
      class="tab" 
      [class.active]="activeFilter() === 'semester2'"
      (click)="setFilter('semester2')">
      <app-svg-icon name="Calendar"></app-svg-icon>
      Semestre 2
    </button>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-state">
      <app-loading-spinner size="lg"></app-loading-spinner>
      <p>Chargement des cours...</p>
    </div>
  }

  <!-- Courses Grid -->
  @if (!isLoading() && filteredCourses().length > 0) {
    <div class="cards-grid">
      @for (course of filteredCourses(); track course.id) {
        <div class="course-card">
          <div class="card-header">
            <div class="course-code-badge">{{ course.code }}</div>
            <span class="status-badge active">
              <app-svg-icon name="CheckCircle2"></app-svg-icon>
              Actif
            </span>
            <div class="card-menu">
              <button class="menu-btn" (click)="toggleMenu(course.id)">
                <app-svg-icon name="MoreVertical"></app-svg-icon>
              </button>
              @if (showMenu === course.id) {
                <div class="menu-dropdown" (click)="$event.stopPropagation()">
                  <button (click)="viewDetails(course); closeMenu()">
                    <app-svg-icon name="Eye"></app-svg-icon>
                    Détails
                  </button>
                  <button (click)="editCourse(course); closeMenu()">
                    <app-svg-icon name="Edit2"></app-svg-icon>
                    Modifier
                  </button>
                  <button (click)="deleteCourse(course); closeMenu()" class="danger">
                    <app-svg-icon name="Trash2"></app-svg-icon>
                    Supprimer
                  </button>
                </div>
              }
            </div>
          </div>

          <div class="card-body">
            <h3>{{ course.name }}</h3>
            <p class="course-description">{{ course.description || 'Aucune description disponible' }}</p>
            
            <div class="card-stats">
              <div class="stat">
                <app-svg-icon name="User"></app-svg-icon>
                <span>{{ course.teacherId }}</span>
              </div>
              <div class="stat">
                <app-svg-icon name="Users"></app-svg-icon>
                <span>40 étudiants</span>
              </div>
              <div class="stat">
                <app-svg-icon name="Calendar"></app-svg-icon>
                <span>{{ course.semesterId }}</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button class="btn-outline" (click)="viewDetails(course)">
              <app-svg-icon name="Eye"></app-svg-icon>
              Détails
            </button>
            <button class="btn-secondary" (click)="editCourse(course)">
              <app-svg-icon name="Edit2"></app-svg-icon>
              Modifier
            </button>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @if (!isLoading() && filteredCourses().length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <app-svg-icon name="BookOpen"></app-svg-icon>
      </div>
      <h3>Aucun cours trouvé</h3>
      <p>{{ searchTerm ? 'Essayez de modifier votre recherche' : 'Commencez par ajouter votre premier cours' }}</p>
      @if (!searchTerm) {
        <button class="btn-primary" (click)="addCourse()">
          <app-svg-icon name="Plus"></app-svg-icon>
          Ajouter un Cours
        </button>
      }
    </div>
  }
</div>

<!-- Modal Ajouter/Modifier un Cours -->
<app-modal 
  [isOpen]="showAddModal || showEditModal" 
  [title]="showAddModal ? 'Ajouter un Cours' : 'Modifier le Cours'" 
  (close)="closeModal()">
  <form class="modal-form">
    <div class="form-group">
      <label>
        <app-svg-icon name="Hash"></app-svg-icon>
        Code du cours *
      </label>
      <input 
        type="text" 
        [(ngModel)]="formData.code" 
        name="code" 
        placeholder="Ex: INF101" 
        [disabled]="showEditModal"
        required>
    </div>

    <div class="form-group">
      <label>
        <app-svg-icon name="BookOpen"></app-svg-icon>
        Nom du cours *
      </label>
      <input 
        type="text" 
        [(ngModel)]="formData.name" 
        name="name" 
        placeholder="Ex: Algorithmique et Programmation" 
        required>
    </div>

    <div class="form-group">
      <label>
        <app-svg-icon name="FileText"></app-svg-icon>
        Description
      </label>
      <textarea 
        [(ngModel)]="formData.description" 
        name="description" 
        placeholder="Description du cours..."
        rows="3"></textarea>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label>
          <app-svg-icon name="User"></app-svg-icon>
          Enseignant *
        </label>
        <input 
          type="text" 
          [(ngModel)]="formData.teacherId" 
          name="teacherId" 
          placeholder="Ex: teacher-1" 
          required>
      </div>
      <div class="form-group">
        <label>
          <app-svg-icon name="Calendar"></app-svg-icon>
          Semestre *
        </label>
        <select 
          [(ngModel)]="formData.semesterId" 
          name="semesterId" 
          required>
          <option value="">Sélectionner un semestre</option>
          <option value="semester-1">Semestre 1</option>
          <option value="semester-2">Semestre 2</option>
        </select>
      </div>
    </div>

    <div class="form-group">
      <label>
        <app-svg-icon name="CalendarDays"></app-svg-icon>
        Année académique *
      </label>
      <select 
        [(ngModel)]="formData.academicYearId" 
        name="academicYearId" 
        required>
        <option value="">Sélectionner une année</option>
        @for (year of academicYears(); track year.id) {
          <option [value]="year.id">{{ year.name }}</option>
        }
      </select>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-secondary" (click)="closeModal()">
        <app-svg-icon name="X"></app-svg-icon>
        Annuler
      </button>
      <button 
        type="button" 
        class="btn-primary" 
        (click)="showAddModal ? saveNewCourse() : saveEditCourse()">
        <app-svg-icon name="Check"></app-svg-icon>
        Enregistrer
      </button>
    </div>
  </form>
</app-modal>

<!-- Modal Voir Détails -->
<app-modal 
  [isOpen]="showViewModal" 
  [title]="'Détails du Cours'" 
  (close)="closeModal()">
  @if (selectedCourse()) {
    <div class="details-view">
      <div class="detail-header">
        <div class="course-code-large">{{ selectedCourse()!.code }}</div>
        <span class="status-badge-large active">
          <app-svg-icon name="CheckCircle2"></app-svg-icon>
          Actif
        </span>
      </div>
      
      <h2 class="course-title">{{ selectedCourse()!.name }}</h2>

      <div class="detail-grid">
        <div class="detail-item">
          <div class="detail-icon">
            <app-svg-icon name="User"></app-svg-icon>
          </div>
          <div>
            <div class="detail-label">Enseignant</div>
            <div class="detail-value">{{ selectedCourse()!.teacherId }}</div>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <app-svg-icon name="Calendar"></app-svg-icon>
          </div>
          <div>
            <div class="detail-label">Semestre</div>
            <div class="detail-value">{{ selectedCourse()!.semesterId }}</div>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <app-svg-icon name="CalendarDays"></app-svg-icon>
          </div>
          <div>
            <div class="detail-label">Année académique</div>
            <div class="detail-value">{{ selectedCourse()!.academicYearId }}</div>
          </div>
        </div>

        <div class="detail-item full-width">
          <div class="detail-icon">
            <app-svg-icon name="FileText"></app-svg-icon>
          </div>
          <div>
            <div class="detail-label">Description</div>
            <div class="detail-value">{{ selectedCourse()!.description || 'Aucune description' }}</div>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">
          <app-svg-icon name="X"></app-svg-icon>
          Fermer
        </button>
        <button type="button" class="btn-primary" (click)="editCourse(selectedCourse()!); closeModal()">
          <app-svg-icon name="Edit2"></app-svg-icon>
          Modifier
        </button>
      </div>
    </div>
  }
</app-modal>

<!-- Modal Supprimer -->
<app-modal 
  [isOpen]="showDeleteModal" 
  [title]="'Confirmer la suppression'" 
  [size]="'small'" 
  (close)="closeModal()">
  @if (selectedCourse()) {
    <div class="delete-confirmation">
      <div class="warning-icon">
        <app-svg-icon name="AlertTriangle"></app-svg-icon>
      </div>
      <p class="warning-text">
        Êtes-vous sûr de vouloir supprimer le cours <strong>{{ selectedCourse()!.name }}</strong> ?
      </p>
      <p class="warning-subtext">Cette action est irréversible.</p>

      <div class="modal-actions">
        <button type="button" class="btn-secondary" (click)="closeModal()">
          <app-svg-icon name="X"></app-svg-icon>
          Annuler
        </button>
        <button type="button" class="btn-danger" (click)="confirmDelete()">
          <app-svg-icon name="Trash2"></app-svg-icon>
          Supprimer
        </button>
      </div>
    </div>
  }
</app-modal>

<div class="teachers-container">
  @if (successMessage()) {
    <div class="alert alert-success">
      <span class="material-icons">check_circle</span>
      {{ successMessage() }}
    </div>
  }

  <div class="page-header">
    <div class="header-left">
      <h2>Gestion des Enseignants</h2>
      <p>Gérez les enseignants et leurs spécialités</p>
    </div>
    <button class="btn btn-primary" (click)="openCreateModal()">
      <span class="material-icons">add</span>
      Nouvel Enseignant
    </button>
  </div>

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon">
        <span class="material-icons">person</span>
      </div>
      <div class="stat-content">
        <div class="stat-label">Total Enseignants</div>
        <div class="stat-value">{{ totalTeachers() }}</div>
      </div>
    </div>

    <div class="stat-card stat-success">
      <div class="stat-icon">
        <span class="material-icons">check_circle</span>
      </div>
      <div class="stat-content">
        <div class="stat-label">Actifs</div>
        <div class="stat-value">{{ activeTeachers() }}</div>
      </div>
    </div>

    <div class="stat-card stat-warning">
      <div class="stat-icon">
        <span class="material-icons">block</span>
      </div>
      <div class="stat-content">
        <div class="stat-label">Inactifs</div>
        <div class="stat-value">{{ inactiveTeachers() }}</div>
      </div>
    </div>
  </div>

  <div class="filters-section">
    <div class="search-box">
      <span class="material-icons">search</span>
      <input 
        type="text" 
        placeholder="Rechercher un enseignant..."
        (input)="onSearch($event)"
        [value]="searchQuery()"
      >
    </div>

    <div class="filter-buttons">
      <button 
        class="filter-btn" 
        [class.active]="filterStatus() === 'ALL'"
        (click)="onFilterStatus('ALL')">
        Tous
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filterStatus() === 'ACTIVE'"
        (click)="onFilterStatus('ACTIVE')">
        Actifs
      </button>
      <button 
        class="filter-btn" 
        [class.active]="filterStatus() === 'INACTIVE'"
        (click)="onFilterStatus('INACTIVE')">
        Inactifs
      </button>
    </div>
  </div>

  @if (isLoading()) {
    <div class="loading">
      <div class="spinner"></div>
      <p>Chargement...</p>
    </div>
  }

  @if (!isLoading()) {
    <div class="table-container">
      <table class="data-table">
        <thead>
          <tr>
            <th>Nom</th>
            <th>Prénom</th>
            <th>Email</th>
            <th>Spécialité</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (teacher of filteredTeachers(); track teacher.id) {
            <tr>
              <td>{{ teacher.nom }}</td>
              <td>{{ teacher.prenom }}</td>
              <td>{{ teacher.email }}</td>
              <td>
                @if (teacher.specialite) {
                  <span class="badge badge-info">{{ teacher.specialite }}</span>
                } @else {
                  <span class="text-muted">-</span>
                }
              </td>
              <td>
                <span class="badge" [class.badge-success]="teacher.estActif" [class.badge-danger]="!teacher.estActif">
                  {{ teacher.estActif ? 'Actif' : 'Inactif' }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button 
                    class="btn-icon" 
                    (click)="openEditModal(teacher)"
                    title="Modifier">
                    <span class="material-icons">edit</span>
                  </button>
                  <button 
                    class="btn-icon" 
                    (click)="toggleStatus(teacher)"
                    [title]="teacher.estActif ? 'Désactiver' : 'Activer'">
                    <span class="material-icons">{{ teacher.estActif ? 'block' : 'check_circle' }}</span>
                  </button>
                  <button 
                    class="btn-icon btn-danger" 
                    (click)="openDeleteModal(teacher)"
                    title="Supprimer">
                    <span class="material-icons">delete</span>
                  </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>

      @if (filteredTeachers().length === 0) {
        <div class="empty-state">
          <span class="material-icons">person</span>
          <p>Aucun enseignant trouvé</p>
          @if (searchQuery() || filterStatus() !== 'ALL') {
            <button class="btn btn-secondary" (click)="searchQuery.set(''); filterStatus.set('ALL'); applyFilters()">
              Réinitialiser les filtres
            </button>
          } @else {
            <button class="btn btn-primary" (click)="openCreateModal()">
              Créer le premier enseignant
            </button>
          }
        </div>
      }
    </div>
  }

  @if (showModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>{{ selectedTeacher() ? 'Modifier' : 'Créer' }} un Enseignant</h3>
          <button class="close-btn" (click)="closeModal()">
            <span class="material-icons">close</span>
          </button>
        </div>

        <form (ngSubmit)="onSubmit()">
          <div class="modal-body">
            @if (errorMessage()) {
              <div class="alert alert-error">
                {{ errorMessage() }}
              </div>
            }

            <div class="form-row">
              <div class="form-group">
                <label>Nom *</label>
                <input 
                  type="text" 
                  [(ngModel)]="formData.nom" 
                  name="nom"
                  placeholder="Nom de famille"
                  required
                >
              </div>

              <div class="form-group">
                <label>Prénom *</label>
                <input 
                  type="text" 
                  [(ngModel)]="formData.prenom" 
                  name="prenom"
                  placeholder="Prénom"
                  required
                >
              </div>
            </div>

            <div class="form-group">
              <label>Email *</label>
              <input 
                type="email" 
                [(ngModel)]="formData.email" 
                name="email"
                placeholder="prenom.nom@saintjeaningenieur.org"
                required
              >
            </div>

            <div class="form-group">
              <label>Spécialité</label>
              <input 
                type="text" 
                [(ngModel)]="formData.specialite" 
                name="specialite"
                placeholder="Ex: Informatique, Mathématiques, Physique..."
              >
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">
              Annuler
            </button>
            <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
              {{ selectedTeacher() ? 'Mettre à jour' : 'Créer' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  }

  @if (showDeleteModal()) {
    <div class="modal-overlay" (click)="closeModal()">
      <div class="modal-content modal-small" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h3>Confirmer la suppression</h3>
          <button class="close-btn" (click)="closeModal()">
            <span class="material-icons">close</span>
          </button>
        </div>

        <div class="modal-body">
          <p>Êtes-vous sûr de vouloir supprimer l'enseignant <strong>{{ selectedTeacher()?.prenom }} {{ selectedTeacher()?.nom }}</strong> ?</p>
          <p class="warning-text">Cette action est irréversible.</p>
        </div>

        <div class="modal-footer">
          <button class="btn btn-secondary" (click)="closeModal()">
            Annuler
          </button>
          <button class="btn btn-danger" (click)="deleteTeacher()" [disabled]="isLoading()">
            Supprimer
          </button>
        </div>
      </div>
    </div>
  }
</div>

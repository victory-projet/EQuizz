<div class="layout-container">
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" (click)="toggleMobileMenu()" *ngIf="isMobile()">
    <span class="material-icons">{{ isMobileMenuOpen() ? 'close' : 'menu' }}</span>
  </button>

  <!-- Mobile Overlay -->
  <div class="mobile-overlay" 
       [class.active]="isMobileMenuOpen()" 
       (click)="onOverlayClick()"
       *ngIf="isMobile()">
  </div>

  <!-- Sidebar -->
  <aside class="sidebar" 
         [class.collapsed]="isSidebarCollapsed()"
         [class.mobile-open]="isMobileMenuOpen()">
    <div class="sidebar-header">
      <div class="logo-container">
        <img src="/logo.png" alt="EQuizz Logo" class="logo-icon">
        <span class="logo-text" *ngIf="!isSidebarCollapsed()">EQuizz</span>
      </div>
      <button class="toggle-btn" (click)="toggleSidebar()">
        <span class="material-icons">{{ isSidebarCollapsed() ? 'menu' : 'menu_open' }}</span>
      </button>
    </div>

    <nav class="sidebar-nav">
      <a routerLink="/dashboard" routerLinkActive="active" class="nav-item">
        <span class="material-icons">home</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Tableau de bord</span>
      </a>

      <a routerLink="/evaluations" routerLinkActive="active" class="nav-item">
        <span class="material-icons">description</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Evaluation</span>
      </a>

      <a routerLink="/courses" routerLinkActive="active" class="nav-item">
        <span class="material-icons">menu_book</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Cours & UE</span>
      </a>

      <a routerLink="/classes" routerLinkActive="active" class="nav-item">
        <span class="material-icons">groups</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Classes</span>
      </a>

      <a routerLink="/associations" routerLinkActive="active" class="nav-item">
        <span class="material-icons">link</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Associations</span>
      </a>

      <a routerLink="/academic-years" routerLinkActive="active" class="nav-item">
        <span class="material-icons">calendar_today</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Année académique</span>
      </a>

      <a routerLink="/reports" routerLinkActive="active" class="nav-item">
        <span class="material-icons">bar_chart</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Rapport</span>
      </a>

      <a routerLink="/students" routerLinkActive="active" class="nav-item">
        <span class="material-icons">school</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Étudiants</span>
      </a>

      <a routerLink="/teachers" routerLinkActive="active" class="nav-item">
        <span class="material-icons">person</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Enseignants</span>
      </a>

      <a routerLink="/users" routerLinkActive="active" class="nav-item">
        <span class="material-icons">admin_panel_settings</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Administrateurs</span>
      </a>

      <a routerLink="/profile" routerLinkActive="active" class="nav-item">
        <span class="material-icons">person</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Mon Profil</span>
      </a>
    </nav>

    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <span class="material-icons">logout</span>
        <span class="nav-text" *ngIf="!isSidebarCollapsed()">Déconnexion</span>
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="page-title">{{ getPageTitle() }}</h1>
        <p class="page-subtitle">{{ getPageSubtitle() }}</p>
      </div>

      <div class="header-right">
        <div class="search-container">
          <span class="material-icons search-icon">search</span>
          <input 
            type="text" 
            class="search-input" 
            [placeholder]="searchPlaceholder()"
            (input)="onSearch($event)"
            (focus)="onSearchFocus()"
            (blur)="onSearchBlur()"
            [value]="searchQuery()"
          >
          
          @if (searchQuery()) {
            <button class="clear-search-btn" (click)="clearSearch()">
              <span class="material-icons">close</span>
            </button>
          }
          
          <!-- Search Suggestions Dropdown -->
          @if (showSearchSuggestions() && searchSuggestions().length > 0) {
            <div class="search-suggestions">
              <div class="suggestions-header">
                <span class="material-icons">history</span>
                <span>Suggestions</span>
              </div>
              
              @for (suggestion of searchSuggestions(); track suggestion) {
                <button 
                  class="suggestion-item"
                  (click)="onSuggestionClick(suggestion)">
                  <span class="material-icons">search</span>
                  <span>{{ suggestion }}</span>
                </button>
              }
              
              @if (searchQuery()) {
                <div class="suggestions-footer">
                  <button class="suggestion-item search-all" (click)="onSuggestionClick(searchQuery())">
                    <span class="material-icons">search</span>
                    <span>Rechercher "{{ searchQuery() }}"</span>
                  </button>
                </div>
              }
            </div>
          }
        </div>

        <!-- Theme Toggle -->
        <app-theme-toggle></app-theme-toggle>

        <div class="user-profile" (click)="toggleUserMenu()">
          <div class="user-info">
            <span class="user-name">{{ authService.currentUser()?.prenom }} {{ authService.currentUser()?.nom }}</span>
            <span class="user-role">Admin</span>
          </div>
          <div class="user-avatar">
            <span class="material-icons">account_circle</span>
          </div>
          
          <!-- User Dropdown Menu -->
          <div class="user-dropdown" [class.active]="isUserMenuOpen()">
            <a routerLink="/profile" class="dropdown-item" (click)="closeUserMenu()">
              <span class="material-icons">person</span>
              <div class="item-content">
                <span class="item-title">Mon Profil</span>
                <span class="item-subtitle">Gérer mes informations</span>
              </div>
            </a>
            
            <a routerLink="/messages" class="dropdown-item messages-item" (click)="closeUserMenu()">
              <span class="material-icons">notifications</span>
              <div class="item-content">
                <span class="item-title">Messages</span>
                <span class="item-subtitle">{{ messagesService.getUnreadCount() }} nouveaux messages</span>
              </div>
              <span class="notification-badge" *ngIf="messagesService.getUnreadCount() > 0">{{ messagesService.getUnreadCount() }}</span>
            </a>
            
            <div class="dropdown-divider"></div>
            <button class="dropdown-item logout-item" (click)="logout()">
              <span class="material-icons">logout</span>
              <div class="item-content">
                <span class="item-title">Déconnexion</span>
                <span class="item-subtitle">Se déconnecter du système</span>
              </div>
            </button>
          </div>
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

# Nom du workflow de Déploiement Continu
name: Backend CD

# Déclencheurs : QUAND ce workflow doit-il s'exécuter ?
on:
  # Uniquement lorsqu'un push est fait sur la branche 'main'
  push:
    branches:
      - main

# Jobs : La liste des tâches à effectuer
jobs:
  # Nom du job de déploiement
  deploy-backend:
    name: Deploy Backend to Railway
    runs-on: ubuntu-latest
    steps:
      # Étape 1 : Récupérer le code de la branche 'main'
      - name: Checkout code
        uses: actions/checkout@v3

      # Étape 2 : Installer la CLI de Railway
      # 'railwayapp/cli-action@v1' est une action officielle de Railway
      - name: Setup Railway CLI
        uses: railwayapp/cli-action

      # Étape 3 : Lancer le déploiement
      # Cette commande envoie le code à Railway, qui s'occupe de le construire
      # et de le mettre en ligne.
      - name: Deploy to Railway
        run: railway up --detach
        env:
          # On utilise le secret que nous avons configuré dans GitHub
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}